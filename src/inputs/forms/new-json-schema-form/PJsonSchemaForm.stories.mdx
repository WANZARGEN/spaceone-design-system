import { Meta, Canvas, Story, ArgsTable } from '@storybook/addon-docs/blocks';
import {
    toRefs, reactive, watch,
} from '@vue/composition-api';
import PJsonSchemaForm from '@/inputs/forms/new-json-schema-form/PJsonSchemaForm.vue';
import PTextEditor from '@/inputs/text-editor/PTextEditor.vue';
import PButton from "@/inputs/buttons/button/PButton";
import PSelectDropdown from "@/inputs/dropdown/select-dropdown/PSelectDropdown";
import {
     getJsonSchemaFormArgTypes,
} from '@/inputs/forms/new-json-schema-form/story-helper';
import {
    getDefaultFormData, getDefaultSchema
} from "@/inputs/forms/new-json-schema-form/mock";
import {supportLanguages} from "@/translations";


<Meta title='Inputs/Forms/Json Schema Form' parameters={{
    design: {
        type: 'figma',
        url: 'https://www.figma.com/file/wq4wSowBcADBuUrMEZLz6i/SpaceONE-Console-Design?node-id=6169%3A180989',
    }
}} argTypes={getJsonSchemaFormArgTypes()} />

export const Template = (args, { argTypes }) => ({
    props: Object.keys(argTypes),
    components: { PJsonSchemaForm },
    template: `
        <p-json-schema-form
            :schema="schema"
            :form-data.sync="proxyFormData"
            :language="language"
        />
    `,
    setup(props) {
        const state = reactive({
            proxyFormData: props.formData
        });
        watch(() => props.formData, (formData) => {
            state.proxyFormData = formData
        })
        return {
            ...toRefs(state)
        }
    }
});



## Basic

<Canvas>
    <Story name="Basic" >
        {{
            components: { PJsonSchemaForm, PTextEditor },
            template: `
<div class="grid grid-cols-12">
    <p-json-schema-form
        class="col-span-6"
        :schema="schema"
        :form-data="formData"
    />
    <div class="col-span-6">
        <p-text-editor :code="JSON.stringify(schema, null, 2)"
                       mode="readOnly"
                       folded
        />
    </div>
</div>
`,
            setup(props) {
                const state = reactive({
                    schema: getDefaultSchema(),
                    formData: {}
                })
                return {
                    ...toRefs(state),
                }
            }
        }}
    </Story>
</Canvas>

<br/>
<br/>

## Language

<Canvas>
    <Story name="Language" >
        {{
            components: { PJsonSchemaForm, PTextEditor, PSelectDropdown },
            template: `
<div class="grid grid-cols-12">
    <p-json-schema-form
        class="col-span-6"
        :schema="schema"
        :form-data="formData"
        :language="language"
    />
    <div class="col-span-6">
        <p-select-dropdown class="mb-4"
                           :selected.sync="language" :items="languages" />
        <p-text-editor :code="JSON.stringify(schema, null, 2)"
                       mode="readOnly"
                       folded
        />
    </div>
</div>
`,
            setup(props) {
                const state = reactive({
                    schema: getDefaultSchema(),
                    formData: getDefaultFormData(),
                    language: 'en',
                    languages: supportLanguages.map(d => ({name: d, label: d}))
                })
                return {
                    ...toRefs(state),
                }
            }
        }}
    </Story>
</Canvas>

<br/>
<br/>


## Playground

<Canvas>
    <Story name="Playground">
        {Template.bind({})}
    </Story>
</Canvas>

<ArgsTable story="Playground"/>

